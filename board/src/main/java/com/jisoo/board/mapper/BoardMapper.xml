<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.jisoo.board.mapper.BoardMapper">
  	<insert id="insertBoard" parameterType="com.jisoo.board.domain.BoardVo">
  		INSERT INTO TBL_BOARD(TITLE, CONTENT, WRITER_ID, WRITER_NAME)
  		VALUES(#{title}, #{content}, #{writerId}, #{writerName})
  	</insert>
  	
  	<select id="selectAllBoards" resultType="com.jisoo.board.domain.BoardVo">
  		SELECT *
  		FROM TBL_BOARD
  		WHERE DELETED_AT IS NULL
  		ORDER BY board_id DESC
  	</select>
  	
  	<select id="selectBoardsPage" resultType="com.jisoo.board.domain.BoardVo">
  		SELECT * 
  		FROM(
	  		SELECT B.*, ROWNUM rn 
	  		FROM(
				SELECT * FROM TBL_BOARD
	  			WHERE DELETED_AT IS NULL
	  			ORDER BY BOARD_ID DESC
	  			) B
  			)
  		WHERE rn BETWEEN #{start} AND #{end}
  	</select>
  	
  	<select id="getCount">
  		SELECT count(*)
  		FROM TBL_BOARD
  		WHERE DELETED_AT IS NULL
  	</select>
  	
  	<select id="selectBoard" resultType="com.jisoo.board.domain.BoardVo">
  		SELECT *
  		FROM TBL_BOARD
  		WHERE BOARD_ID = #{boardId}
  	</select>
  	
  	<select id="isOwner">
  		SELECT COUNT(*)
  		FROM TBL_BOARD
  		WHERE
  			WRITER_ID = #{userId}
  			AND
  			BOARD_ID = #{boardId}
  	</select>
  	
  	<update id="updateBoard" parameterType="com.jisoo.board.domain.BoardVo">
  		UPDATE TBL_BOARD
  		SET
			TITLE = #{title},
  			CONTENT = #{content},
  			UPDATED_AT = SYSDATE
  		WHERE BOARD_ID = #{boardId}
  	</update>
  	
  	<update id="deleteBoard">
  		UPDATE TBL_BOARD
  		SET
  			DELETED_AT = SYSDATE
  		WHERE BOARD_ID = #{boardId}
  	</update>
  	
  	<update id="increaseViewCount">
  		UPDATE TBL_BOARD
  		SET
  			VIEW_COUNT = VIEW_COUNT + 1
  		WHERE BOARD_ID = #{boardId}
  	</update>
  	
  	<update id="increaseLikeCount">
  		UPDATE TBL_BOARD
  		SET
  			LIKE_COUNT = LIKE_COUNT + 1
  		WHERE BOARD_ID = #{boardId}
  	</update>
  	
  	<update id="decreaseLikeCount">
  		UPDATE TBL_BOARD
  		SET
  			LIKE_COUNT = LIKE_COUNT - 1
  		WHERE BOARD_ID = #{boardId}
  	</update>
  	
  	<insert id="insertBoardLike">
  		INSERT INTO TBL_BOARD_LIKE (board_id, user_id, created_at)
		VALUES(#{boardId}, #{userId}, SYSDATE)
  	</insert>

	<delete id="deleteBoardLike">
		DELETE FROM TBL_BOARD_LIKE
		WHERE
			BOARD_ID = #{boardId}
			AND
			USER_ID = #{userId}
	</delete>  	
  </mapper>