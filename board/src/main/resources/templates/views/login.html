<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>login</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet">
</head>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
	const p = new URLSearchParams(location.search);
	if (p.has("error")){
		alert("		パスワードが正しくありません。");
		location.href = "/login";		
	}
	
	var idOk = false;
	
	$(function(){
		$("#btnNext").on("click", function(e){
			e.preventDefault();
			
			var userId = $("#inputId").val().trim();
			
			if(!idOk){
				
				$.ajax({
					url: "/auth/check-id",
					type: "GET",
					data: {id: userId},
					dataType: "json",
					success: function(res){
						if(res.isChecked){
							$("#inputId").attr("disabled", true);							
							$("#inputPw").removeAttr("hidden");
							$("#btnPrev").removeAttr("hidden");
							idOk = true;
						} else{
							alert("そのIDはありません。");
						}
					}});
			}//if
			else{
				$("#inputId").removeAttr("disabled");
				$("#loginForm").submit();
			}
			
		});
		
		$("#btnPrev").on("click", function(e){
			e.preventDefault();
			
			$("#inputId").removeAttr("disabled").val("");							
			$("#inputPw").attr("hidden" ,true).val("");
			$("#btnPrev").attr("hidden" ,true);
			idOk = false;
			
		});
		
	})
</script>
<body>
<!-- ===== Header ===== -->
<header class="border-bottom py-3 bg-light">
	<div class="container d-flex align-items-center">
		<h2 class="mb-0">LOGO</h2>
		<a class="btn btn-outline-secondary ms-auto" th:href="@{/}">ホームへ</a>
	</div>
</header>

<!-- ===== body ===== -->
<main class="container mt-4">
  <div class="row">
	<form id="loginForm" action="/login" method="post">
		<h1>ログイン</h1>
		<input id="inputId" name="inputId" type="text" class="form-control" placeholder="ID">
		<input id="inputPw" name="inputPw" type="password" class="form-control" placeholder="PW" hidden>
		<button type="button" id="btnPrev" hidden>前へ</button>
		<button type="button" id="btnNext">次へ</button><br>
		<a href="#">ログインができない場合</a><br>
		<a href="signup">新規登録</a>
		<a href="#" hidden>バスワードを忘れた場合</a>
	</form>		
  </div>

  
</main>

<!-- ===== Footer ===== -->
<footer class="border-top mt-5 py-3 text-center text-muted">
</footer>

</body>
</html>
