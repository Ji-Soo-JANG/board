<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>signup</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet">
</head>

<body>
	<!-- jQuery -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script>
		$(function(){
			$("#btnInfo").on("click", function(e){
				e.preventDefault();
				
				var nickname = $("#inputNickname").val().trim();
				$.ajax({
					url: "/mypage/edit",
					type: "POST",
					data: {nickname: nickname},
					dataType: "json",
					success: function(res){
						if(res.update){
							alert("保存しました。");
						}else{
							alert("更新に失敗しました。");
						}
					}
				});
			});
			
			$("#btnPassword").on("click", function(e){
				e.preventDefault();
				
				var newPassword = $("#inputPassword").val().trim();
				var newPasswordConfirm = $("#inputPasswordConfirm").val().trim();
				
				if(newPassword == ""){
					alert("パスワードを入力してください。");
				}else if(newPassword != newPasswordConfirm){
					alert("パスワードが違います。");
				}else{
					$.ajax({
						url: "/mypage/password",
						type: "POST",
						data: {password: newPassword},
						dataType: "json",
						success: function(res){
							if(res.update){
								alert("保存しました。");
								location.href = "/mypage/verify";
							}else{
								alert("更新に失敗しました。");
							}
						}
					});
				}
			})
		})
	</script>
	
<!-- ===== Header ===== -->
<header class="border-bottom py-3">
  <div class="container d-flex align-items-center">
    <h2 class="me-4 mb-0">LOGO</h2>

  </div>
</header>

<!-- ===== body ===== -->
<main class="container mt-4">
  <div class="row">
	<h1>マイページ</h1>
	<form id="infoForm" method="post">
	  <div>
	    <label>ID</label>
	    <input type="text" class="form-control" th:value="${user.loginId}" disabled>
	  </div>
	  <div>
	    <label>ニックネーム</label>
	    <input id="inputNickname" type="text" class="form-control" name="nickname" th:value="${user.nickname}">
	  </div>
	  <button id="btnInfo" type="button">修正</button>
	</form>
	<form id="passwordForm">
	  <input id="inputPassword" type="password" class="form-control" name="newPassword" placeholder="新しいパスワード" required>
	  <input id="inputPasswordConfirm" type="password" class="form-control" name="confirmPassword" placeholder="新しいパスワード確認" required>
	  <button id="btnPassword" type="button">変更</button>
	</form>
	
  </div>
</main>

<!-- ===== Footer ===== -->
<footer class="border-top mt-5 py-3 text-center text-muted">
</footer>

</body>
</html>
